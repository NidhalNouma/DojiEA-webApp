(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[468],{9273:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Accounts",function(){return n(4370)}])},1422:function(e,t,n){"use strict";n.d(t,{_:function(){return a},P1:function(){return c}});var r=n(5893);function a(e){var t=e.className,n=e.label;return(0,r.jsx)("label",{className:t+" block my-2 text-sm font-medium text-slate-400",children:n})}function c(e){var t=e.className,n=e.children;return(0,r.jsx)("p",{className:t+" block my-2 text-sm font-medium text-slate-400",children:n})}},2395:function(e,t,n){"use strict";n.d(t,{H1:function(){return a},H4:function(){return c}});var r=n(5893);function a(e){var t=e.className,n=e.label;return(0,r.jsx)("div",{className:t+" max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("h1",{className:"text-3xl font-bold text-slate-100",children:n})})}function c(e){var t=e.className,n=e.label;return(0,r.jsx)("div",{className:t+" max-w-7xl mx-auto py-1",children:(0,r.jsx)("h1",{className:"text-lg font-bold text-slate-200",children:n})})}},9929:function(e,t,n){"use strict";n.d(t,{Gt:function(){return p},EO:function(){return x},$:function(){return v},F0:function(){return m},Vb:function(){return f},o6:function(){return h},ME:function(){return b}});var r=n(4051),a=n.n(r),c=n(9669),s=n.n(c),o=n(3352);function i(e,t,n,r,a,c,s){try{var o=e[c](s),i=o.value}catch(l){return void n(l)}o.done?t(i):Promise.resolve(i).then(r,a)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var c=e.apply(t,n);function s(e){i(c,r,a,s,o,"next",e)}function o(e){i(c,r,a,s,o,"throw",e)}s(void 0)}))}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}var p=function(){var e=l(a().mark((function e(t,n,r,c,o,i,l,u){var d,p,x,v,m,f=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=f.length>8&&void 0!==f[8]?f[8]:"",console.log("Create Subscription ..."),e.prev=2,e.next=6,s().post("/api/stripe/createSubscription",{userId:t,customerId:n,paymentMethodId:r,priceId:c,coupon:d,price:o,name:i,accounts:u,type:l});case 6:return m=e.sent,e.abrupt("return",{subscriptions:null===m||void 0===m||null===(p=m.data)||void 0===p?void 0:p.subscriptions,intents:null===m||void 0===m||null===(x=m.data)||void 0===x?void 0:x.intents,r:null===m||void 0===m||null===(v=m.data)||void 0===v?void 0:v.r,error:null===m||void 0===m?void 0:m.error});case 10:e.prev=10,e.t0=e.catch(2),console.error("Create Subscription .",e.t0);case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,n,r,a,c,s,o,i){return e.apply(this,arguments)}}(),x=function(){var e=l(a().mark((function e(t,n){var r,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("cancel Subscription ..."),e.prev=1,e.next=5,s().post("/api/stripe/cancelSubscription",{subscriptionId:t,customerId:n});case 5:return c=e.sent,console.log(c),e.abrupt("return",null===c||void 0===c||null===(r=c.data)||void 0===r?void 0:r.subscriptions);case 10:e.prev=10,e.t0=e.catch(1),console.error("cancel Subscription .",e.t0);case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,n){return e.apply(this,arguments)}}(),v=(function(){var e=l(a().mark((function e(t,n,r,c){var o,i,l,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.load){e.next=2;break}return e.abrupt("return");case 2:if(""!==t.value){e.next=5;break}return n(d({},t,{err:"Invalid coupon"})),e.abrupt("return");case 5:return n(d({},t,{err:"",load:!0})),console.log("Checking coupon ... ",t.value),e.prev=7,e.next=10,s().post("/check-coupon",{coupon:t.value});case 10:if(!(o=e.sent).data.err||!o.data.err.raw){e.next=17;break}return n(d({},t,{err:o.data.err.raw.message,load:!1})),c(d({},r,{new:-1})),e.abrupt("return");case 17:o.data.res&&(i=-1,l=o.data.res.percent_off,u=o.data.res.amount_off,l?i=r.old-r.old*l/100:u&&u>0&&(i=r.old-u)<0&&(i=0),c(d({},r,{new:i})));case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(7),console.error("Checcking coupon .",e.t0);case 23:n(d({},t,{load:!1,err:""}));case 24:case"end":return e.stop()}}),e,null,[[7,20]])})))}(),function(){var e=l(a().mark((function e(t,n){var r,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Adding Payment Method ..."),e.prev=1,e.next=5,s().post("/api/stripe/addPaymentMethod",{customerId:n,paymentMethodId:t});case 5:return c=e.sent,e.abrupt("return",null===c||void 0===c||null===(r=c.data)||void 0===r?void 0:r.paymentMethods);case 9:e.prev=9,e.t0=e.catch(1),console.error("Adding Payment Method Subscription .",e.t0);case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,n){return e.apply(this,arguments)}}()),m=function(){var e=l(a().mark((function e(t,n){var r,c,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Retriving Payment Method ... "),r=null,e.prev=2,e.next=6,s().post("/api/stripe/detachPaymentMethod",{id:t,customerId:n});case 6:o=e.sent,r=null===o||void 0===o||null===(c=o.data)||void 0===c?void 0:c.paymentMethods,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.error("Adding Payment Method Subscription .",e.t0);case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,n){return e.apply(this,arguments)}}();function f(e){var t=0;return null===e||void 0===e||e.forEach((function(e){var n;t+=(0,o.ek)(null===(n=e.plan)||void 0===n?void 0:n.id)})),t}function h(e){var t=0;return null===e||void 0===e||e.forEach((function(e){var n;t+=(0,o.ek)(null===(n=e.metadata)||void 0===n?void 0:n.priceId)})),t}function b(e,t){var n=0;return null===e||void 0===e||e.forEach((function(e){e.isActive===t&&n++})),n}},4370:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var r=n(5893),a=n(7294),c=n(7673),s=n(4051),o=n.n(s),i=n(3801),l=n(9629),u=n(1422),d=n(7322),p=n(4374);var x=function(e){var t=e.className,n=e.color,a=e.value,c=e.title;return(0,r.jsxs)("div",{className:"".concat(t," bg-c2 rounded border border-b-0 border-c1"),children:[(0,r.jsx)("div",{className:"p-3 pb-2",children:(0,r.jsxs)("p",{className:"text-slate-300",children:[(0,r.jsx)("span",{className:"".concat(n," !bg-c2 font-bold"),children:a})," ",c]})}),(0,r.jsx)("div",{className:"".concat(n," pt-1 rounded")})]})},v=n(9929);function m(e,t,n,r,a,c,s){try{var o=e[c](s),i=o.value}catch(l){return void n(l)}o.done?t(i):Promise.resolve(i).then(r,a)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var c=e.apply(t,n);function s(e){m(c,r,a,s,o,"next",e)}function o(e){m(c,r,a,s,o,"throw",e)}s(void 0)}))}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){h(e,t,n[t])}))}return e}function w(){var e,t,n,a,c=(0,l.SE)().user,s=null===c||void 0===c?void 0:c.accounts;return(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsx)("div",{className:"-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:(0,r.jsxs)("div",{className:"py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"mb-6 flex",children:[(0,r.jsx)(x,{color:"text-slate-100 bg-slate-400",value:(0,v.Vb)(null===c||void 0===c||null===(e=c.stripe)||void 0===e||null===(t=e.subscription)||void 0===t?void 0:t.data)+(0,v.o6)(null===c||void 0===c||null===(n=c.stripe)||void 0===n||null===(a=n.intent)||void 0===a?void 0:a.data)-(0,v.ME)(s,!0),title:"Availble to use"}),(0,r.jsx)(x,{color:"bg-teal-400 text-teal-400",value:(0,v.ME)(s,!0),title:"Active account",className:"mx-4"}),(0,r.jsx)(x,{color:"text-red-400 bg-red-400",value:(0,v.ME)(s,!1),title:"Inactive account"})]}),(0,r.jsx)(j,{})]})})})}function j(){var e=(0,a.useState)(!1),t=e[0],n=e[1],c=(0,l.SE)(),s=c.user,x=c.setUser,v=null===s||void 0===s?void 0:s.accounts;return(0,r.jsxs)("div",{className:"shadow overflow-hidden border-b border-c2 sm:rounded-lg",children:[(0,r.jsxs)("table",{className:"min-w-full divide-y divide-slate-600",children:[(0,r.jsx)("thead",{className:"bg-c2",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-slate-100 uppercase tracking-wider",children:"Name"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-slate-100 uppercase tracking-wider",children:"Number"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-slate-100 uppercase tracking-wider",children:"Server"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-slate-100 uppercase tracking-wider",children:"Status"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-slate-100 uppercase tracking-wider",children:t?(0,r.jsx)(d.pw,{classNameSpin:"!mr-0 ml-auto !h-5 !w-5 !text-slate-500"}):(0,r.jsx)(i.DuK,{className:"text-slate-300 inline h-5 w-5 cursor-pointer","aria-hidden":"true",onClick:f(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(!0),e.next=3,(0,p.T8)(s.uid);case 3:t=e.sent,x(b({},s,{accounts:t})),n(!1);case 6:case"end":return e.stop()}}),e)})))})})]})}),(0,r.jsx)("tbody",{className:"bg-c1 divide-y divide-c2",children:v.map((function(e,t){return(0,r.jsx)(N,{val:e},t)}))})]}),0===v.length&&(0,r.jsx)(u.P1,{className:"text-center py-3",children:"No account are being used"})]})}function N(e){var t=e.val,n=(0,l.SE)(),a=n.user,c=n.setUser;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm font-medium text-slate-400",children:t.accountName})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm font-medium text-slate-400",children:t.accountNumber})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-slate-400",children:t.accountServer})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:t.isActive?(0,r.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-c1",children:"Active"}):(0,r.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-c1",children:"Inactive"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.isActive?(0,r.jsx)(d.tV,{label:"Disable",className:"ml-auto !text-slate-500",classNameSpin:"ml-auto !text-slate-500 !w-5 !h-5",onClick:f(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.mU)(a.uid,t.id,!1);case 2:n=e.sent,c(b({},a,{accounts:n}));case 4:case"end":return e.stop()}}),e)})))}):(0,r.jsx)(d.tV,{label:"Enable",className:"ml-auto",classNameSpin:"ml-auto !w-5 !h-5",onClick:f(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.mU)(a.uid,t.id,!0);case 2:n=e.sent,c(b({},a,{accounts:n}));case 4:case"end":return e.stop()}}),e)})))})})]})}var y=n(2395);var g=function(){return(0,r.jsxs)("div",{children:[(0,r.jsx)(c.Z,{}),(0,r.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6",children:(0,r.jsxs)("div",{className:"pt-12 pb-12 md:pt-20 md:pb-20",children:[(0,r.jsx)(y.H1,{label:"Accounts"}),(0,r.jsx)("main",{children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto py-3 sm:px-6 lg:px-8",children:(0,r.jsx)(w,{})})})]})})]})}}},function(e){e.O(0,[1,673,774,888,179],(function(){return t=9273,e(e.s=t);var t}));var t=e.O();_N_E=t}]);